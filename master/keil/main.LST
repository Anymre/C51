C51 COMPILER V9.52.0.0   MAIN                                                              03/20/2019 18:00:35 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include <reg51.h>      //头文件
   2          
   3          
   4          //倒计时
   5          unsigned char buf[4];             //秒显示的变量
   6          unsigned int EW_time_default = 25;      //东西默认值
   7          unsigned int SN_time_default = 30;      //南北默认值
   8          unsigned int EW_time_now = 20;    //东西方向当前数秒
   9          unsigned int SN_time_now = 30;    //南北方向当前数秒
  10          
  11          //字型码
  12          unsigned char code LED[] = {0xc0, 0xf9, 0xa4, 0xb0, 0x99, 0x92, 0x82, 0xf8, 0x80, 0x90};
  13          
  14          
  15          unsigned char code NUM[] = {0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f,0x40}; 
  16          
  17          
  18          //计数
  19          unsigned int time0_count;
  20          
  21          //红绿灯
  22          sbit Green_EW = P2 ^ 1;   //东西
  23          sbit Yellow_EW = P2 ^ 2;
  24          sbit Red_EW = P2 ^ 3;
  25          
  26          sbit Red_SN = P2 ^ 6;   //南北
  27          sbit Yellow_SN = P2 ^ 5;
  28          sbit Green_SN = P2 ^ 4;
  29          
  30          //函数声明
  31          void delay(int ms);     //延时
  32          void display();       //显示倒计时
  33          void init();          //开机初始化
  34          void Timer0Init();       //定时器0
  35          
  36          void main()
  37          {
  38   1          init();
  39   1          while (1) {
  40   2              display();
  41   2          }
  42   1      }
  43          
  44          void init()
  45          {
  46   1          //开总中断
  47   1          EA = 1;
  48   1          ET0 = 1;      //开定时器0
  49   1          //定时器0
  50   1          Timer0Init();
  51   1      
  52   1      }
  53          
  54          void time0() interrupt 1
  55          {
C51 COMPILER V9.52.0.0   MAIN                                                              03/20/2019 18:00:35 PAGE 2   

  56   1          //重置定时器
  57   1          TH0 = 0x4c;
  58   1          TL0 = 0x00;
  59   1          time0_count++;
  60   1          if(time0_count < 20) {}
  61   1          else {
  62   2              time0_count = 0;
  63   2              if(EW_time_now > 0) {
  64   3                  EW_time_now--;
  65   3              } else {
  66   3                  EW_time_now = EW_time_default;
  67   3              }
  68   2              if(EW_time_now > 0) {
  69   3                  EW_time_now--;
  70   3              } else {
  71   3                  EW_time_now = EW_time_default;
  72   3              }
  73   2          }
  74   1      }
  75          
  76          void display() //显示子程序
  77          {
  78   1          //南北方向个位十位
  79   1          buf[1] = SN_time_now / 10;
  80   1          buf[2] = SN_time_now % 10;
  81   1          //东西方向个位十位
  82   1          buf[3] = EW_time_now / 10;
  83   1          buf[4] = EW_time_now % 10;
  84   1      
  85   1          //点亮南北方向倒计时
  86   1          P1 = 0x01;              //片选LED1
  87   1          P0 = LED[buf[1]];     //送南北时间十位的数码管编码
  88   1          delay(1);       //延时
  89   1      
  90   1          P1 = 0x02;              //片选LED2
  91   1          P0 = LED[buf[2]];
  92   1          delay(1);
  93   1      
  94   1          P1 = 0X04;          //片选LED3
  95   1          P0 = LED[buf[3]];       //送东西时间十位的数码管编码
  96   1          delay(1);       //延时
  97   1      
  98   1          P1 = 0X08;        //片选LED4
  99   1          P0 = LED[buf[4]];
 100   1          delay(1);
 101   1      }
 102          
 103          void delay(int ms)      //延时子程序
 104          {
 105   1          unsigned int j, k;
 106   1          for (j = 0; j < ms; j++)
 107   1              for (k = 0; k < 124; k++)
 108   1                  ;
 109   1      }
 110          
 111          void Timer0Init()   //50毫秒@11.0592MHz
 112          {
 113   1          TMOD = 0x01;  //设置定时器模式
 114   1          TL0 = 0x00;   //设置定时初值
 115   1          TH0 = 0x4C;   //设置定时初值
 116   1          TF0 = 0;      //清除TF0标志
 117   1          TR0 = 1;      //定时器0开始计时
C51 COMPILER V9.52.0.0   MAIN                                                              03/20/2019 18:00:35 PAGE 3   

 118   1      }
 119          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    257    ----
   CONSTANT SIZE    =     21    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     14    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
